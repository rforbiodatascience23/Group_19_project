# Effect of different variables on mortality

During that part, we will investigate to determine in what extent some variables affect the mortality of the patients.

We start by adding three variables to the dataset. The three variable are three different etiologies and their significance concerning Child Pugh score was assessed with a linear regression model in the file `09_analysis.qmd`. Because the Child Pugh Score indicates the severity of the cirrhosis, it could be related to the mortality, and we will verify that hypothesis with the following plots.

```{r}
dat_mortality <- dat_aug_03 |> 
  mutate(Alcohol = ifelse(Etiologies == "Alcohol_consumption", "yes", "no")) |> 
  mutate(NAFLD = ifelse(Etiologies == "Non_alcoolic_fatty_LD", "yes", "no")) |> 
  mutate(Cryptogenic = ifelse(Etiologies == "Cryptogenic", "yes", "no")) 

dat_mortality

```

## Age impact on mortality

First, we will see how the age of the patients impact their mortality by plotting the distribution of patient outcomes stratified by age.

```{r}

ggplot(
  data = dat_mortality,
  mapping = aes(x = Age,
                fill = Mortality,
                na.rm = TRUE)
) +
  geom_bar(alpha = 0.6,
           position = "stack") +
  scale_fill_viridis_d() +
  labs(
  title = "Distribution of patient outcomes ",
  subtitle = "stratified by age",
  x = "Age",
  y = "Count"
)

```

```{r}
Age_impact_mortality <- ggplot(
  data = dat_aug_03,
  mapping = aes(x = Age,
                fill = Mortality,
                na.rm = TRUE)
) +
  geom_bar(alpha = 0.6,
           position = "fill") +
  scale_fill_viridis_d() +
  labs(
  title = "Proportions of patient outcomes ",
  subtitle = "stratified by age",
  x = "Age",
  y = "Proportions"
)

Age_impact_mortality
```

The plot showing the proportions of patient outcomes is more relevant than the one showing their distribution, because it is relative to the count of patients. Nonetheless, the distribution plot allows us to see that the age categories \[30,40\] and \[90,100\] don't contain enough patients to be statistically relevant. Therefore, if we only take the other age categories into consideration, we can see slight increase in mortality when the age of the patients is increasing.

## Alcohol consumption impact on mortality

To determine if alcohol consumption impacts mortality, we plot the distribution and the proportions of patient outcomes stratified by alcohol consumption.

```{r}
Alcohol_distribution <- ggplot(
  data = dat_mortality,
  mapping = aes(x = Alcohol,
                fill = Mortality,
                na.rm = TRUE)
) +
  geom_bar(alpha = 0.6,
           position = "stack") +
  scale_fill_viridis_d() +
  labs(
  title = "Patient outcomes",
  subtitle = "stratified by alcohol consumption",
  x = "Alcohol consumption"
) + 
  theme(legend.position = "none")
```

```{r}
Alcohol_proportions <- ggplot(
  data = dat_mortality,
  mapping = aes(x = Alcohol,
                fill = Mortality,
                na.rm = TRUE)
) +
  geom_bar(alpha = 0.6,
           position = "fill") +
  scale_fill_viridis_d() +
  labs(
  title = "Proportions of patient outcomes ",
  subtitle = "stratified by alcohol consumption",
  x = "Alcohol consumption",
  y = "Proportions"
)

Alcohol_impact_mortality <- Alcohol_distribution | Alcohol_proportions
Alcohol_impact_mortality
```

The proportions plot shows a small increase in mortality when the patients are alcohol consumers.

### Saving the plot

```{r}
ggsave("Alcohol_impact_mortality.png", 
       path = "../results/plots/",
       plot = Alcohol_impact_mortality,
       width = 7,
       height = 5)
```

# LD Mortality

```{r}
bar_plot_LD_Mortality<- dat_aug_03 |> 
  ggplot(aes(x = Liver_disease, 
             fill = Mortality)) +
  geom_bar(position = "fill", 
           stat = "count", 
           alpha = 0.7) +
  labs(title = "Liver disease repartition in cyrrhosis patients, stratified by mortality",
       y = "Proportion") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(axis.title.x=element_blank()) +
  scale_x_discrete(guide = guide_axis(angle = 25))

```

```{r}
ggsave("LD_Mortality.png", 
       path = "../results/plots/",
       plot = bar_plot_LD_Mortality,
       width = 7,
       height = 5)
```

```{r}
bar_plot_LD_Mortality
```

# CPS Mortality

```{r}
bar_plot_CPS_Mortality<- dat_aug_03 |> 
  ggplot(aes(x = Mortality,
             y = CPS,
             fill = Mortality)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "CPS value accuratly describe the mortality of cirrhosis' patients ",
       y = "CPS") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank()) +
  scale_x_discrete(guide = guide_axis(angle = 25))

bar_plot_CPS_Mortality

```
