---
title: "04_describe"
format: html
editor: visual
---

# Descriptive statistics

## General information on the data set

```{r}
dim_desc(dat_aug_03)
dim_desc(dat_load_01)
```

We have a final data set of 1,065 observations with 9 variables, after tidying a
data set of 733 patients suffering from cirrhosis.

## Sex and Age group of the patients' population

The total number of patients stratified by gender can be visualized with the 
following plots:

```{r}
bar_plot_total_by_gender <- dat_aug_03 |> 
  ggplot(aes(x = "Overall", 
             fill = Sex)) +
  geom_bar(position = "stack", 
           stat = "count", 
           alpha = 0.7) +
  labs(title = "Total Count",
       x = "Patients",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal()

bar_plot_total_by_gender_facet <- bar_plot_total_by_gender +
  facet_grid(. ~ Sex, 
             scales = "free_y") +
  theme(strip.text.y = element_blank(), 
        strip.background = element_blank(), 
        axis.text.x = element_text(size = 7))

```

Patch of both plots

```{r}
bar_plot_total_by_gender_2 <- dat_aug_03 |> 
  ggplot(aes(x = "Overall", 
             fill = Sex)) +
  geom_bar(position = "stack", 
           stat = "count", 
           alpha = 0.7) +
  labs(x = "Patients",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal() +
    theme(strip.text.y = element_blank(), 
        strip.background = element_blank(), 
        axis.text.x = element_text(size = 7))

bar_plot_total_by_gender_facet_2 <- bar_plot_total_by_gender_2 +
  facet_grid(. ~ Sex, 
             scales = "free_y") +
  theme(strip.text.y = element_blank(), 
        strip.background = element_blank(), 
        axis.text.x = element_text(size = 7))

combined_plot_2 <- bar_plot_total_by_gender_2 + 
  bar_plot_total_by_gender_facet_2 + 
  plot_annotation(title = "Total Count")
```

```{r}
ggsave("Total_by_gender.png", 
       path = "../results/plots/",
       plot = bar_plot_total_by_gender,
       width = 7,
       height = 5)
ggsave("Total_by_gender(facet).png", 
       path = "../results/plots/",
       plot = bar_plot_total_by_gender_facet,
       width = 7,)
ggsave("Total_by_gender(patch).png", 
       path = "../results/plots/",
       plot = combined_plot_2,
       width = 7,
       height = 5)
```

To observe the age and gender distribution, a stacked bar plot for the age 
distribution, stratified by gender, can be used.\
To better illustrate that both have their mode at \[60;70\], the plot is also 
shown faceted.

```{r}
bar_plot_age_gender <- dat_aug_03 |>
  ggplot(aes(x = Age, 
             fill = Sex)) +
  geom_bar(position = "stack", 
           stat = "count", 
           alpha = 0.7) +
  labs(title = "Overview of the age and gender distribution of patients with 
       liver cirrhosis",
       x = "Age Group",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal()

bar_plot_age_gender_facet <- bar_plot_age_gender +
  facet_grid(. ~ Sex, 
             scales = "free_y") +
  theme(strip.text.y = element_blank(), 
        strip.background = element_blank(), 
        axis.text.x = element_text(size = 7))
```

Patch of both plots

```{r}
bar_plot_age_gender_2 <- dat_aug_03 |>
  ggplot(aes(x = Age, 
             fill = Sex)) +
  geom_bar(position = "stack", 
           stat = "count", 
           alpha = 0.7) +
  labs(x = "Age Group",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(strip.text.y = element_blank(), 
        strip.background = element_blank(), 
        axis.text.x = element_text(size = 5))

bar_plot_age_gender_facet_2 <- bar_plot_age_gender_2 +
  facet_grid(. ~ Sex, 
             scales = "free_y") +
  theme(strip.text.y = element_blank(), 
        strip.background = element_blank(), 
        axis.text.x = element_text(size = 3))

combined_plot_1 <- bar_plot_age_gender_2 + 
  bar_plot_age_gender_facet_2 + 
  plot_annotation(title = "Overview of the age and gender distribution of 
                  patients with liver cirrhosis")
```

```{r}
ggsave("Age_gender.png", 
       path = "../results/plots/",
       plot = bar_plot_age_gender,
       width = 7,
       height = 5)
ggsave("Age_gender(facet).png", 
       path = "../results/plots/",
       plot = bar_plot_age_gender_facet,
       width = 7,
       height = 5)
ggsave("Age_gender(patch).png", 
       path = "../results/plots/",
       plot = combined_plot_1,
       width = 7,
       height = 5)
```

All plots provide a visual representation of the distribution of patients with 
cirrhosis based on age and gender.

-   the x-axis always represents the age groups and the y-axis is always the 
count for the patients

-   the gender is illustrated by different colors - yellow for male and purple 
for female

Description

-   Mode: The mode is for both women and men in the 60 to 70 age group. The 
number of patients in this age group is 517 (Female: 150, Male 367).

-   Gender Representation: Women make up about 29.67 percent of patients and men
about 70.33 percent. This means that the number of patients is predominantly 
male.

```{r}
mode_of_age <- dat_aug_03 |> 
  filter(str_detect(Age, "\\[60;|70]" )) |> 
  summarise(count = n())
print(mode_of_age)
```

```{r}
mode_of_age_sex <- dat_aug_03 |> 
  filter(str_detect(Age, "\\[60;|70]" )) |> 
  group_by(Sex) |> 
  summarise(count = n())
print(mode_of_age_sex)
```

```{r}
dat_aug_03 |> 
  count(Sex)
```

## Overview of the liver disease in the patients' population

```{r}
dat_LD <- dat_aug_03 |> 
  count(Liver_disease)
```

Ascites and hepatic encephalopathy are the two main liver diseases diagnosed. 
Ascites, representing 40% of liver diseases, is a build up of fluid in the 
abdomen, often as a consequence of cirrhosis. Hepatic encephalopathy is also a
common pathology in patients with cirrhosis due to deficiencies in their 
neurological system, here representing 33% of the study.

```{r}
bar_plot_LD<- dat_LD |> 
  ggplot(aes(x = reorder(Liver_disease,-n), 
             y = n, 
             fill = Liver_disease)) +
  geom_bar(stat = 'identity', 
           alpha = 0.7, 
           show.legend = FALSE) +
  labs(title = "Liver disease repartition in cyrrhosis patients",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(axis.title.x=element_blank()) +
  scale_x_discrete(guide = guide_axis(angle = 25))
```

```{r}
bar_plot_LD
```

## Overview of comorbities in the patients' population

Comorbidities are additional disease that can interact and coexist 
simultaneously with the cirrhosis. The study of comorbidities is pertinent since
it can explain some of the patients' complications and can play a role in their
recovery.

```{r}
dat_comorb <- dat_aug_03 |> 
  count(Comorbidities) 
```

```{r}
bar_plot_comorbidities <- dat_comorb |> 
  ggplot(aes(x = reorder(Comorbidities,-n), 
             y = n,
             fill = Comorbidities)) +
  geom_bar(stat = 'identity', 
           alpha = 0.7, 
           show.legend = FALSE) +
  geom_text(aes(label = n), 
            vjust = -0.5, 
            size = 2) +
  labs(title = "Overview of comorbidities across patients suffering from 
       cirrhosis ",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(legend.title=element_blank(), 
        axis.title.x = element_blank()) +
  scale_x_discrete(guide = guide_axis(angle = 63))

bar_plot_comorbidities
```

```{r}
ggsave("Overview_Comorbidities.png", 
       path = "../results/plots/",
       plot = bar_plot_comorbidities,
       width = 7,
       height = 5)
```


The plot illustrates the various concomitant diseases of the patients and 
provides an overview of the number of each condition.

-   the x-axis represents the comorbidities and the y-axis is the count of 
patients

-   In addition, each comorbidity is listed in different colors and the exact 
number is indicated above the respective bar.

-   The mode are moderately severe liver diseases with a comparatively high 
count of 509.

-   The majority of patients suffer from concomitant diseases. Only 8 patients 
suffer only from liver cirrhosis.

## Overview of ethiology factor across population

Ethiology is the study of the factors that come together leading to a disease.

```{r}
dat_etio <- dat_aug_03 |> 
  count(Etiologies)
```

```{r}
dat_etio
```

```{r}
bar_plot_etiology <- dat_etio |> 
  ggplot(aes(x = reorder(Etiologies,-n), 
             y = n,
             fill = Etiologies)) +
  geom_bar(stat = 'identity', 
           alpha = 0.7, 
           show.legend = FALSE) +
  geom_text(aes(label = n), 
            vjust = -0.5, 
            size = 3) +
  labs(title = "Overview of cirrhosis etiology across patients' population",
       y = "Count") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(legend.title=element_blank(), 
        axis.title.x = element_blank()) +
  scale_x_discrete(guide = guide_axis(angle = 30))

bar_plot_etiology
```

```{r}
ggsave("Overview_Etiology.png", 
       path = "../results/plots/",
       plot = bar_plot_etiology,
       width = 7,
       height = 5)
```

The plot illustrates the various etiologies which lead to diseases and counts 
them.

-   the x-axis represents the etiologies and the y-axis is the count of patients

-   The etiologies are listed in different colors and the exact number is 
indicated above the respective bar.

-   The mode isthe consumption of alcohol with a count of 549 followed by 
hepatitis C with a count of 357. Both are likely major factors at causing liver
cirrhosis.

## Overview of two important numerical values: CPS and Charlson_CI

The dataset chosen featured two variables:

-   **CPS or Child-Pugh Score** for Cirrhosis Mortality: useful in the 
determination of the prognosis of patients suffering from a cirrhosis. With a 
maximum value of 15, it is based on the presence of ascites, the concentratin of
some proteins in the blood (bilirubin, albumin)...

-   **Charlson Comorbidity index**: useful to predict the mortality of patients 
suffering from comorbidities. Depends on the presence of comorbidities and the 
age of the patient

```{r}
box_plot_CPS <- dat_aug_03 |> 
  ggplot(aes(x = CPS)) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "CPS and Charlson_CI") +
  theme_minimal() +
  coord_flip()

box_plot_Charlson <- dat_aug_03 |> 
  ggplot(aes(x = Charlson_CI)) +
  geom_boxplot(alpha = 0.7) +
  theme_minimal() +
  coord_flip()

box_plot_CPS_Charlson <- box_plot_CPS_ | box_plot_Charlson_ 

box_plot_CPS_Charlson
```

```{r}
ggsave("Boxplot_CPS.png", 
       path = "../results/plots/",
       plot = box_plot_CPS,
       width = 7,
       height = 5)

ggsave("Boxplot_Charlson.png", 
       path = "../results/plots/",
       plot = box_plot_Charlson,
       width = 7,
       height = 5)
```

```{r}
mean_CPS <- dat_aug_03 |> 
  summarize(mean(CPS))

mean_CPS
```

```{r}
mean_Charlson <- dat_aug_03 |> 
  summarize(mean(Charlson_CI))

mean_Charlson
```

The average value of the CPS and the Charlson comorbidity index are reciprocally
8.39 and 4.81. It is in the group B of CPS which implies a 80% 1-year survival 
rate and 60% 2-year survival rate.

### Relation between Charlson value and the type of comorbidities

Charlson value represents a comorbidity index that predicts 10y life expectancy 
for people with multiple comorbidities. This graph shows the weight of varioous 
Comorbidiities in the Charlson Index

```{r}

box_plot_Charlson_Comorbidities <- dat_aug_03 |> 
  ggplot(mapping = aes(x = Comorbidities,
                       y = Charlson_CI)) +
  geom_boxplot() +
  labs(title = 'Impact of diverse comorbidities on the 10 year life expectancy
       of patients',
       y = 'Charlson Comorbidity Index') +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))

box_plot_Charlson_Comorbidities
```

```{r}
ggsave("Charlson_comorbidities.png", 
       path = "../results/plots/",
       plot = box_plot_Charlson_Comorbidities,
       width = 7,
       height = 5)
```

From the boxplot, we can deduce that AIDS and Metastatic solid tumor are 2 of 
the major comorbidities that have an important weight on the Charlson CI. On the 
opposite side of the spectrum, mild liver disease and rheumatological have a 
limited impact on the variable. Less weight means that the diseaseis not severe
enough to affect directly and significantly the life expectancy of the patient.

## Overview of comorbidities and liver disease

```{r}
stacked_bar_liverDisease <- dat_aug_03 |>
  select(Liver_disease, Comorbidities) |> 
  count(Liver_disease, Comorbidities)|>
  rename(d_c_count = n) |> 
  arrange(Liver_disease, desc(d_c_count)) |>
  mutate(Comorbidities = fct_inorder(Comorbidities))
```

```{r}
bubble_order <- c("UGIB due to portal hypertension",
                  "Jaundice- as isolated presentation",
                  "Hepatic encephalopathy",
                  "Hepato-hydrothorax",
                  "HCC or cholangioca.",
                  "Alcoholic hepatitis",
                  "Other fluid overload",
                  "Ascites",
                  "SBP",
                  "AKI")
bubble_chart <- stacked_bar_liverDisease |>
  arrange(match(Liver_disease,bubble_order))
```

```{r}
bubble_comorbiditie_by_LD <- ggplot(bubble_chart,
       aes(x = factor(Liver_disease, bubble_order), 
           y = Comorbidities,
           colour = Liver_disease,
           size = d_c_count)) +
  geom_point() +
  geom_text(aes(label = d_c_count), 
            colour = "white", 
            size = 3) +
  scale_x_discrete(position = "top") +
  scale_color_viridis_d() +
  scale_size_continuous(range = c(3, 9)) +
  labs(x = NULL, y = NULL, title= "Comorbidities by Liver Disease") +
  theme(legend.position = "none",
        panel.background = element_blank(),
        panel.grid = element_blank(),
        axis.ticks = element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 0))

bubble_comorbiditie_by_LD
```

```{r}
ggsave("Bubble_plot.png", 
       path = "../results/plots/",
       plot = bubble_comorbiditie_by_LD,
       width = 7,
       height = 5)
```

From this visualisation graph, it appears that Hepatic Encephalopaty liver 
disease has the greatest amount of comorbidities observed. On the opposite, we
observe fewer Comorbidities for for jaundice and Hepato-hydrothorax. 
Additionally, the most common combination is Ascites with Moderate Liver disease
as a comorbidity.
